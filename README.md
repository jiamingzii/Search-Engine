# 高性能单机并发搜索引擎（C++17）

## 项目简介

本项目是一个基于 **C++17** 实现的单机搜索引擎系统，覆盖 **网页解析、去重、倒排索引构建、BM25 排序、关键词推荐、高并发查询与缓存优化** 等完整检索链路。

系统面向 **大规模文本数据场景** 设计，在 30 万篇文档规模下完成稳定压测，重点关注 **检索性能、内存占用与高并发稳定性**，适合作为 C++ 后端 / 搜索方向的工程实践示例。

---

## 技术栈

- **语言 / 平台**：C++17 / Linux  
- **服务框架**：Workflow / wfrest（异步 HTTP 服务）  
- **检索核心**：倒排索引、BM25 相关性排序  
- **文本处理**：cppjieba 中文分词  
- **去重算法**：SimHash（64 位指纹 + 汉明距离）  
- **缓存机制**：分段锁 LRU Cache  
- **核心数据结构**：`unordered_map`、`vector`、`priority_queue`  
- **构建工具**：Makefile  

---


---

## 核心模块说明

### 1. 网页解析与预处理
- 支持从 `.xml / .dat` 文件中流式解析网页数据
- 采用 **分块读取（1MB Chunk）**，避免一次性加载大文件导致内存峰值过高
- 提取标题、URL、正文内容并完成分词统计

### 2. 基于 SimHash 的网页去重
- 为每篇文档生成 **64 位 SimHash 指纹**
- 使用 **汉明距离 < 3** 判断相似文档
- 在预处理阶段过滤重复内容，提升索引质量并减少冗余计算

### 3. 倒排索引与 BM25 排序
- 构建 **Term → Posting List** 的倒排索引结构
- 使用 **BM25** 计算词项在文档中的权重，考虑：
  - 词频（TF）
  - 文档频率（DF）
  - 文档长度归一化
- 倒排表在离线阶段完成排序，在线查询避免重复排序开销

### 4. 查询阶段 TopK 优化
- 查询时使用 **`std::partial_sort`** 进行 TopK 选取
- 将排序复杂度由 **O(N log N)** 降低至 **O(N log K)**  
- 有效控制高并发场景下的长尾延迟

### 5. 关键词推荐（Suggest）
- 基于 **最小编辑距离（Edit Distance）** 实现拼写纠错与相似词推荐
- 支持 UTF-8 中文字符
- 对查询字符串做 **Loop Hoisting 优化**，避免在词典遍历中重复分配内存

### 6. 分段锁 LRU 缓存
- 设计 **16 分片（Sharded）LRU Cache**
- 通过哈希分流请求，降低多线程环境下的锁竞争
- 支持缓存命中率统计，用于运行时监控

### 7. 内存优化（轻量模式）
- 采用 **“元数据内存驻留 + 正文磁盘存储”** 的冷热分离方案
- 搜索阶段仅在生成摘要时按需读取正文片段
- 显著降低服务运行时的内存占用

### 8. 异常数据与健壮性处理
- 清理标题 / URL 中的非法分隔符与换行符
- 过滤无效 UTF-8 字节，防止 JSON 序列化崩溃
- 提升大规模数据场景下的稳定性


---

## 性能测试

在 **30 万篇文档规模** 下进行压力测试：

- 并发线程数：4  
- 并发请求数：100  
- 单机 QPS：≈ 40,000  
- **P99 延迟 < 7ms**  
- 持续 30 秒压测 **零失败请求**

在修复大规模脏数据场景下的解析与编码问题后：

- **P99 延迟降低约 21%**
- **最大延迟降低约 58%**
- 系统稳定性显著提升


---





